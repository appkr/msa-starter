openApiGenerate {
    generatorName = 'spring'
    inputSpec = "${rootDir}/src/main/resources/swagger/api.yml".toString()
    outputDir = "${buildDir}/openapi".toString()
    apiPackage = '{{packageName}}.rest'
    modelPackage = '{{packageName}}.rest'
    modelNameSuffix = 'Dto'
    apiFilesConstrainedTo = ['']
    modelFilesConstrainedTo = ['']
    supportingFilesConstrainedTo = ['ApiUtil.java']
    configOptions = [
            reactive: 'true',
            delegatePattern: 'true',
            title: '{{projectName}}',
            useTags: 'true',
            dateLibrary: 'java8',
            java8: 'true',
            hideGenerationTimestamp: 'true'
    ]
    validateSpec = true
    importMappings = [Problem: 'org.zalando.problem.Problem']
}

sourceSets {
    main {
        java {
            srcDir file("${project.buildDir.path}/openapi/src/main/java")
        }
    }
}

compileJava.dependsOn('openApiGenerate')

task redoc(type:Exec) {
    // For this to work correctly, `yarn global add redoc`
    commandLine 'npx', 'redoc-cli', 'bundle', "${rootDir}/src/main/resources/swagger/api.yml", '-o', "${buildDir}/redoc.html"
}

asyncapi {
    // Prerequisite: brew install node
    version = '1.9.14'
    asyncapi = "${rootDir}/src/main/resources/swagger/asyncapi.yml"
    template = '@asyncapi/html-template'
    output = "${buildDir}"
    forceWrite = true
    parameters = [
            'singleFile': 'true',
            'outFilename': 'asyncapi.html'
    ]
}
